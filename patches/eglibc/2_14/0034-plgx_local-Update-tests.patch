From bc5748bfa0bb6000274b74ab800a84fc627727d5 Mon Sep 17 00:00:00 2001
From: David Holsgrove <david.holsgrove@petalogix.com>
Date: Mon, 28 May 2012 22:56:39 +1000
Subject: [PATCH 34/41] plgx_local: Update tests

Signed-off-by: David Holsgrove <david.holsgrove@petalogix.com>
---
 plgx_local/eglibc.tests  |  460 ++++++++++++++++++++++++++++++++++++----------
 plgx_local/eglibctest.sh |   15 +-
 2 files changed, 373 insertions(+), 102 deletions(-)

diff --git a/plgx_local/eglibc.tests b/plgx_local/eglibc.tests
index d6f02d7..c2c4fc1 100644
--- a/plgx_local/eglibc.tests
+++ b/plgx_local/eglibc.tests
@@ -1,117 +1,381 @@
-./posix/runptests
-./posix/globtest
-./posix/test-vfork
-./posix/wordexp-test
-./posix/testfnm
-./posix/runtests
-./csu/test-as-const-tcb-offsets
-./stdio-common/test-fseek
-./stdio-common/test-popen
-./stdio-common/test-fwrite
-./stdio-common/temptest
-./stdio-common/test-vfprintf
-./stdio-common/test_rdwr
-./libio/test-freopen
-./libio/test-fmemopen
-./dlfcn/failtest
-./ctype/test_ctype
+./argp/argp-test
+./argp/tst-argp1
+./argp/tst-argp2
+./assert/test-assert
+./assert/test-assert-perr
+./catgets/test-gencat
+./catgets/tst-catgets
+./crypt/md5c-test
 ./crypt/md5test
-./crypt/sha512c-test
+./crypt/sha256c-test
 ./crypt/sha256test
-./crypt/md5c-test
+./crypt/sha512c-test
 ./crypt/sha512test
-./crypt/sha256c-test
-./timezone/test-tz
-./nss/test-netdb
-./nss/tst-nss-test1
-./wctype/test_wcfuncs
-./wctype/test_wctype
-./catgets/test-gencat
-./argp/argp-test
-./math/test-fenv
+./csu/test-as-const-tcb-offsets
+./csu/tst-empty
+./ctype/test_ctype
+./debug/test-stpcpy_chk
+./debug/test-strcpy_chk
+./debug/tst-backtrace2
+./debug/tst-backtrace3
+./debug/tst-backtrace4
+./debug/tst-backtrace5
+./debug/tst-chk1
+./debug/tst-chk2
+./debug/tst-chk3
+./debug/tst-lfschk1
+./debug/tst-lfschk2
+./debug/tst-lfschk3
+./dirent/tst-seekdir
+./dlfcn/failtest
+./dlfcn/tstatexit
+./dlfcn/tstcxaatexit
+./dlfcn/tst-dladdr
+./dlfcn/tststatic
+./dlfcn/tststatic2
+./elf/tst-align2
+./elf/tst-audit1
+./elf/tst-audit2
+./elf/tst-leaks1
+./elf/tst-tls1
+./elf/tst-tls10
+./elf/tst-tls11
+./elf/tst-tls12
+./elf/tst-tls1-static
+./elf/tst-tls2
+./elf/tst-tls2-static
+./elf/tst-tls3
+./elf/tst-tls9-static
+./gnulib/tst-gcc
+./grp/testgrp
+./grp/tst_fgetgrent
+./inet/htontest
+./inet/test-ifaddrs
+./inet/test_ifindex
+./inet/test-inet6_opt
+./inet/tst-ether_line
+./inet/tst-gethnm
+./inet/tst-getni1
+./inet/tst-getni2
+./inet/tst-inet6_rth
+./intl/tst-gettext
+./intl/tst-gettext2
+./intl/tst-gettext3
+./intl/tst-ngettext
+./intl/tst-translit
+./io/ftwtest
+./io/test-lfs
+./io/test-stat
+./io/test-stat2
+./io/test-utime
+./libio/test-fmemopen
+./libio/test-freopen
+./math/atest-exp
+./math/atest-exp2
 ./math/atest-sincos
-./math/test-fpucw
-./math/test-tgmath-int
-./math/test-misc
+./math/basic-test
+./math/test-dbl-wrap
 ./math/test-double
-./math/test-tgmath-ret
-./math/test-tgmath2
+./math/test-fenv
+./math/test-float
+./math/test-fpucw
+./math/test-idouble
 ./math/test-ifloat
-./math/test-tgmath
-./math/test-dbl-wrap
-./math/atest-exp
 ./math/test-matherr
-./math/test-idouble
-./math/basic-test
-./math/atest-exp2
+./math/test-misc
 ./math/test-powl
-./math/test-float
-./wcsmbs/test-wcslen
-./wcsmbs/test-wcscmp
-./wcsmbs/test-wcschr
-./wcsmbs/test-wmemcmp
-./grp/testgrp
-./assert/test-assert-perr
-./assert/test-assert
+./math/test-tgmath
+./math/test-tgmath2
+./math/test-tgmath-int
+./math/test-tgmath-ret
+./misc/tst-dirname
+./misc/tst-efgcvt
+./misc/tst-fdset
+./misc/tst-hsearch
+./misc/tst-insremque
+./misc/tst-mntent
+./misc/tst-mntent2
+./misc/tst-pselect
+./misc/tst-tsearch
+./nptl/test-as-const-lowlevelbarrier
+./nptl/test-as-const-lowlevelcond
+./nptl/test-as-const-lowlevelrobustlock
+./nptl/test-as-const-lowlevelrwlock
+./nptl/test-as-const-pthread-errnos
+./nptl/test-as-const-pthread-pi-defines
+./nptl/test-as-const-structsem
+./nptl/test-as-const-unwindbuf
+./nptl/tst-abstime
+./nptl/tst-align
+./nptl/tst-align2
+./nptl/tst-align3
+./nptl/tst-attr1
+./nptl/tst-attr2
+./nptl/tst-attr3
+./nptl/tst-backtrace1
+./nptl/tst-barrier1
+./nptl/tst-barrier2
+./nptl/tst-barrier3
+./nptl/tst-barrier4
+./nptl/tst-basic1
+./nptl/tst-basic2
+./nptl/tst-basic3
+./nptl/tst-basic4
+./nptl/tst-basic5
+./nptl/tst-basic6
+./nptl/tst-basic7
+./nptl/tst-cancel1
+./nptl/tst-cancel10
+./nptl/tst-cancel11
+./nptl/tst-cancel12
+./nptl/tst-cancel13
+./nptl/tst-cancel14
+./nptl/tst-cancel15
+./nptl/tst-cancel16
+./nptl/tst-cancel19
+./nptl/tst-cancel2
+./nptl/tst-cancel20
+./nptl/tst-cancel21
+./nptl/tst-cancel22
+./nptl/tst-cancel23
+./nptl/tst-cancel25
+./nptl/tst-cancel3
+./nptl/tst-cancel4
+./nptl/tst-cancel5
+./nptl/tst-cancel6
+./nptl/tst-cancel7
+./nptl/tst-cancel8
+./nptl/tst-cancel9
+./nptl/tst-cancelx10
+./nptl/tst-cancelx11
+./nptl/tst-cancelx12
+./nptl/tst-cancelx13
+./nptl/tst-cancelx14
+./nptl/tst-cancelx15
+./nptl/tst-cancelx16
+./nptl/tst-cancelx2
+./nptl/tst-cancelx20
+./nptl/tst-cancelx21
+./nptl/tst-cancelx3
+./nptl/tst-cancelx4
+./nptl/tst-cancelx5
+./nptl/tst-cancelx6
+./nptl/tst-cancelx7
+./nptl/tst-cancelx8
+./nptl/tst-cancelx9
+./nptl/tst-cleanup0
+./nptl/tst-cleanup1
+./nptl/tst-cleanup2
+./nptl/tst-cleanup3
+./nptl/tst-cleanup4
+./nptl/tst-cleanupx0
+./nptl/tst-cleanupx1
+./nptl/tst-cleanupx2
+./nptl/tst-cleanupx3
+./nptl/tst-cleanupx4
+./nptl/tst-detach1
+./nptl/tst-dlsym1
+./nptl/tst-eintr1
+./nptl/tst-eintr2
+./nptl/tst-eintr3
+./nptl/tst-eintr4
+./nptl/tst-eintr5
+./nptl/tst-exec1
+./nptl/tst-exec2
+./nptl/tst-exec3
+./nptl/tst-exec4
+./nptl/tst-execstack
+./nptl/tst-exit1
+./nptl/tst-exit2
+./nptl/tst-exit3
+./nptl/tst-fini1
+./nptl/tst-getpid1
+./nptl/tst-getpid2
+./nptl/tst-getpid3
+./nptl/tst-initializers1
+./nptl/tst-initializers1-c89
+./nptl/tst-initializers1-c99
+./nptl/tst-initializers1-gnu89
+./nptl/tst-initializers1-gnu99
+./nptl/tst-key1
+./nptl/tst-key2
+./nptl/tst-key3
+./nptl/tst-key4
+./nptl/tst-kill1
+./nptl/tst-kill2
+./nptl/tst-kill3
+./nptl/tst-kill4
+./nptl/tst-kill5
+./nptl/tst-kill6
+./nptl/tst-mutex1
+./nptl/tst-mutex2
+./nptl/tst-mutex3
+./nptl/tst-mutex4
+./nptl/tst-mutex5
+./nptl/tst-mutex5a
+./nptl/tst-mutex6
+./nptl/tst-mutex7
+./nptl/tst-mutex7a
+./nptl/tst-mutex8
+./nptl/tst-mutex9
+./nptl/tst-mutexpi1
+./nptl/tst-mutexpi2
+./nptl/tst-mutexpi3
+./nptl/tst-raise1
+./nptl/tst-sched1
+./nptl/tst-sem1
+./nptl/tst-sem10
+./nptl/tst-sem11
+./nptl/tst-sem12
+./nptl/tst-sem13
+./nptl/tst-sem2
+./nptl/tst-sem3
+./nptl/tst-sem4
+./nptl/tst-sem6
+./nptl/tst-sem7
+./nptl/tst-sem8
+./nptl/tst-sem9
+./nptl/tst-signal1
+./nptl/tst-signal2
+./nptl/tst-signal4
+./nptl/tst-signal5
+./nptl/tst-signal6
+./nptl/tst-signal7
+./nptl/tst-spin1
+./nptl/tst-spin2
+./nptl/tst-spin3
+./nptl/tst-stack1
+./nptl/tst-stack2
+./nptl/tst-stack3
+./nptl/tst-tls1
+./nptl/tst-tls2
+./nptl/tst-tls3
+./nptl/tst-tsd1
+./nptl/tst-tsd2
+./nptl/tst-tsd3
+./nptl/tst-tsd4
+./nptl/tst-tsd5
+./nptl/tst-tsd6
+./nptl/tst-typesizes
+./nptl/tst-umask1
+./nss/test-netdb
+./nss/tst-nss-test1
+./posix/globtest
+./posix/runptests
+./posix/runtests
+./posix/testfnm
+./posix/test-vfork
+./posix/wordexp-test
+./pwd/tst-getpw
+./rt/tst-cputimer1
+./rt/tst-cputimer2
+./rt/tst-cputimer3
+./rt/tst-mqueue1
+./rt/tst-mqueue2
+./rt/tst-mqueue3
+./rt/tst-mqueue4
+./rt/tst-mqueue5
+./rt/tst-mqueue6
+./rt/tst-mqueue7
+./rt/tst-mqueue8
+./rt/tst-mqueue8x
+./rt/tst-mqueue9
+./rt/tst-shm
+./rt/tst-timer
+./rt/tst-timer2
+./rt/tst-timer3
+./rt/tst-timer4
+./rt/tst-timer5
+./setjmp/tst-setjmp
+./signal/tst-raise
+./signal/tst-signal
+./signal/tst-sigset
+./signal/tst-sigset2
+./signal/tst-sigsimple
+./stdio-common/temptest
+./stdio-common/test-fseek
+./stdio-common/test-fwrite
+./stdio-common/test-popen
+./stdio-common/test_rdwr
+./stdio-common/test-vfprintf
+./stdlib/test-a64l
+./stdlib/test-canon
+./stdlib/test-canon2
+./stdlib/testdiv
+./stdlib/testmb
+./stdlib/testmb2
+./stdlib/testrand
+./stdlib/testsort
+./stdlib/tst-bsearch
+./stdlib/tst-fmtmsg
+./stdlib/tst-limits
+./stdlib/tst-putenv
+./stdlib/tst-rand48
+./stdlib/tst-rand48-2
+./stdlib/tst-system
+./stdlib/tst-unsetenv1
+./stdlib/tst-xpg-basename
+./string/inl-tester
+./string/noinl-tester
+./string/testcopy
+./string/tester
 ./string/test-ffs
 ./string/test-memccpy
-./string/test-strspn
-./string/test-strcat
-./string/test-strncpy
-./string/test-mempcpy
-./string/test-strcspn
-./string/test-strchr
-./string/test-strstr
-./string/test-strncasecmp
-./string/test-stpcpy
 ./string/test-memchr
+./string/test-memcmp
+./string/test-memcpy
 ./string/test-memmem
-./string/test-strncmp
-./string/test-stpncpy
-./string/test-strcmp
-./string/test-strpbrk
-./string/test-memset
-./string/test-strrchr
 ./string/test-memmove
+./string/test-mempcpy
+./string/test-memset
 ./string/test-rawmemchr
-./string/test-memcmp
-./string/noinl-tester
-./string/testcopy
-./string/tester
-./string/inl-tester
+./string/test-stpcpy
+./string/test-stpncpy
 ./string/test-strcasecmp
 ./string/test-strcasestr
+./string/test-strcat
+./string/test-strchr
 ./string/test-strchrnul
-./string/test-strnlen
-./string/test-memcpy
-./string/test-strncat
+./string/test-strcmp
+./string/test-strcspn
 ./string/test-strlen
-./time/test_time
+./string/test-strncasecmp
+./string/test-strncat
+./string/test-strncmp
+./string/test-strncpy
+./string/test-strnlen
+./string/test-strpbrk
+./string/test-strrchr
+./string/test-strspn
+./string/test-strstr
+./string/tst-bswap
+./string/tst-endian
+./string/tst-inlcall
+./string/tst-strfry
+./string/tst-strlen
+./string/tst-strxfrm
+./string/tst-strxfrm2
+./string/tst-svc
+./string/tst-svc2
 ./time/clocktest
-./inet/htontest
-./inet/test_ifindex
-./inet/test-ifaddrs
-./inet/test-inet6_opt
-./stdlib/test-a64l
-./stdlib/test-canon
-./stdlib/test-canon2
-./stdlib/testrand
-./stdlib/testmb2
-./stdlib/testmb
-./stdlib/testsort
-./stdlib/testdiv
-./nptl/test-as-const-unwindbuf
-./nptl/test-as-const-lowlevelbarrier
-./nptl/test-as-const-lowlevelrobustlock
-./nptl/test-as-const-pthread-pi-defines
-./nptl/test-as-const-pthread-errnos
-./nptl/test-as-const-lowlevelrwlock
-./nptl/test-as-const-lowlevelcond
-./nptl/test-as-const-structsem
-./debug/test-stpcpy_chk
-./debug/test-strcpy_chk
-./io/test-stat
-./io/test-utime
-./io/test-stat2
-./io/ftwtest
-./io/test-lfs
+./time/test_time
+./time/tst-ftime_l
+./time/tst-getdate
+./time/tst-mktime
+./time/tst-mktime2
+./time/tst-mktime3
+./time/tst-strftime
+./time/tst-strptime
+./time/tst-strptime2
+./time/tst-strptime3
+./time/tst_wcsftime
+./timezone/test-tz
+./wcsmbs/test-wcschr
+./wcsmbs/test-wcscmp
+./wcsmbs/test-wcslen
+./wcsmbs/test-wmemcmp
+./wcsmbs/tst-wchar-h
+./wcsmbs/tst-wcpncpy
+./wcsmbs/tst-wcsnlen
+./wctype/test_wcfuncs
+./wctype/test_wctype
diff --git a/plgx_local/eglibctest.sh b/plgx_local/eglibctest.sh
index 359b631..e3b4fd1 100755
--- a/plgx_local/eglibctest.sh
+++ b/plgx_local/eglibctest.sh
@@ -11,7 +11,7 @@ setup()
 	mkdir -p ${results_dir}
 	test_log=${results_dir}/test.$$.log
 	results_log=${results_dir}/test.$$.sum
-
+	STANDARD_LIBRARY_PATH=$LD_LIBRARY_PATH
 	if [ -z ${timeout} ];then
 		timeout=15
 	fi
@@ -21,15 +21,22 @@ main ()
 {
 	for test in $(cat ${test_list});
 	do
-		timeout -t ${timeout} ${test} >> ${test_log}
+		path=$(echo $test | sed 's|\.\/\(.*\/\).*|\/tmp\/build-libc-final/\1|g')
+		echo "---------------------" >> ${test_log}
+		echo "BEGIN TEST: ${test}" >> ${test_log}
+		LD_LIBRARY_PATH=${path}:$STANDARD_LIBRARY_PATH timeout -t ${timeout} ${test} >> ${test_log}
 		rc=$?
 		if [ "${rc}" == "0" ];then
 			echo "PASS: ${test}" | tee -a ${results_log}
+			echo "PASS" >> ${test_log}
 		elif [ "${rc}" == "143" ];then
 			echo "TIMEOUT: ${test}" | tee -a ${results_log}
+			echo "Timed out after ${timeout}s" >> ${test_log}
 		else
 			echo "FAIL: ${test}" | tee -a ${results_log}
+			echo "FAIL rc=${rc}" >> ${test_log}
 		fi
+		echo "END TEST: ${test}" >> ${test_log}
 	done
 
 	total_num=$(cat ${test_list} | wc -l )
@@ -43,11 +50,11 @@ main ()
 	echo " PetaLinux EGLIBC Test Run, $(date)" | tee -a ${results_log}
 	echo " target is $(hostname)" | tee -a ${results_log}
 	echo "" | tee -a ${results_log}
-	echo " # of unexpected failures  ${num_fail} " | tee -a ${results_log}
 	echo " # of expected passes      ${num_pass} " | tee -a ${results_log}
+	echo " # of unexpected failures  ${num_fail} " | tee -a ${results_log}
+	echo " # of unsupported tests    ${num_timeout} " | tee -a ${results_log}
 	echo "" | tee -a ${results_log}
 	echo " # total                   ${total_num}" | tee -a ${results_log}
-	echo " # timed out               ${num_timeout} " | tee -a ${results_log}
 	echo "" | tee -a ${results_log}
 	echo "-----------------------------------------------------------------------------" | tee -a ${results_log}
 	echo "" | tee -a ${results_log}
-- 
1.7.1

